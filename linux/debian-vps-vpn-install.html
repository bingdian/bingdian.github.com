<!DOCTYPE html>
<html lang="zh-CN"> 
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="On The Way" />
    <meta name="application-name" content="On The Way" />
    <title>Debian vps下 PPTP VPN 安装笔记 - On The Way</title>
    <meta name="keywords" content="linux,debian,vpn,pptp" />
    <meta name="description" content="Debian vps下 PPTP VPN 安装笔记" />
    
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="On The Way" />
    <link rel="stylesheet" href="/static/style.css?v=245b5" />
    <link rel="canonical" href="http://wlog.cn/linux/debian-vps-vpn-install.html" />
    <!--[if lt IE 9]>
    <script src="/static/js/html5shiv.js?v=fb4e3"></script>
    <![endif]-->
</head>
<body>
<div id="wrapper">   
<header id="header" class="clear">
    <h1>Debian vps下 PPTP VPN 安装笔记</h1>
</header><!-- #header -->
<nav id="nav" role="navigation">
    <a href="/index.html">INDEX</a>
    <a href="/tag/index.html">TAGS</a>
    <a href="/project.html">PROJECTS</a>
    <a href="/about.html">ABOUT ME</a>
    <a href="/links.html">LINKS</a>
    <a href="/feed.xml">FEED</a>
</nav><article id="main" class="hentry">
    <!-- <h1 class="entry-title">Debian vps下 PPTP VPN 安装笔记</h1> -->
    <div class="entry-content">
        <h2 id="toc_0">一、安装环境检测</h2>
<p>下面介绍两种检测方法，只要符合其中的一条就可以安装</p>

<pre><code>zgrep MPPE /proc/config.gz</code></pre>
<p>返回 CONFIG_PPP_MPPE=y</p>

<pre><code>cat /dev/net/tun</code></pre>
<p>返回 cat: /dev/net/tun: File descriptor in bad state</p>

<h2 id="toc_1">二、安装pptp</h2>

<pre><code>apt-get update
apt-get install pptpd
apt-get install ppp
apt-get install iptables</code></pre>

<h2 id="toc_2">三、配置PPTP服务器</h3></h2>
<p>1）编辑/etc/pptpd.conf</p>
<p>查找：</p>

<pre><code>#remoteip 192.168.0.234-238,192.168.0.245
# or
#localip 192.168.0.234-238,192.168.0.245</code></pre>
<p>后面添加如下内容：</p>

<pre><code>llocalip 192.168.217.1
remoteip 192.168.217.234-238,192.168.217.245</code></pre>
<p>注：此处的remoteip指定的IP范围是用来给远程连接使用的。如果您远程访问VPN，VPN就会在remoteip范围内分配一个ip地址给你。localip的值直接影响到后面要说的iptables转发规则的编写，所以建议不要随意改动</p>
<p>2）添加PPTP VPN用户</p>
<p>编辑/etc/ppp/chap-secrets 添加如下内容：</p>

<pre><code>username pptpd password *</code></pre>
<p>根据您的需要添加账号，每行一个。格式：“用户名 pptp 密码 ip地址”，中间用空格隔开。</p>
<p>3）修改DNS服务器</p>
<p>编辑/etc/ppp/options，添加如下内容：</p>

<pre><code>ms-dns 8.8.8.8
ms-dns 8.8.4.4</code></pre>
<p>4）修改内核设置，使其支持转发。</p>
<p>编辑/etc/sysctl.conf</p>
<p>将：</p>

<pre><code>#net.ipv4.ip_forward=1</code></pre>
<p>改成：</p>

<pre><code>net.ipv4.ip_forward=1</code></pre>
<p>将</p>

<pre><code>net.ipv4.tcp_syncookies = 1</code></pre>
<p>改成</p>

<pre><code>#net.ipv4.tcp_syncookies = 1</code></pre>
<p>保存关闭后，执行以下命令使修改后的内核生效</p>

<pre><code>sysctl -p</code></pre>
<p>5）添加iptables转发规则</p>
<p>以下两条命令分别对应OpenVZ架构和XEN架构的VPS。</p>
<p>适合于OpenVZ架构的VPS,12.34.56.78为您VPS的公网IP地址</p>

<pre><code>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -j SNAT --to-source 12.34.56.78</code></pre>
<p>适合于XEN架构的VPS</p>

<pre><code>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE</code></pre>
<p>添加好规则后保存并重启iptables</p>

<pre><code>/etc/init.d/iptables save 
/etc/init.d/iptables restart</code></pre>
<p>在/etc/network/if-up.d/目录下创建iptables文件，内容如下：</p>

<pre><code>#!/bin/sh
iptables-restore &lt; /etc/iptables.pptp</code></pre>
<p>给脚本添加执行权限：</p>

<pre><code>chmod +x /etc/network/if-up.d/iptables</code></pre>
<p>6）重启pptp服务</p>

<pre><code>/etc/init.d/pptpd restart</code></pre>
<p>7）设置pptp和iptables随系统启动</p>

<pre><code>chkconfig pptpd on 
chkconfig iptables on</code></pre>
<p>如果出现错误619则输入命令</p>

<pre><code>mknod /dev/ppp c 108 0</code></pre>
<p>ok,enjoy it!</p>

    </div>
    <div class="entry-meta">
        Posted in<time class="updated" datetime="2011-11-21T22:28:00+08:00" pubdate>
            2011-11-21
        </time>
        <span class="entry-tags">Category:<a href="/discover/">Discover</a></span>
        <span class="entry-tags">Tags:
            
                <a href="/tag/linux/">linux</a>
            
                ,<a href="/tag/debian/">debian</a>
            
                ,<a href="/tag/vpn/">vpn</a>
            
                ,<a href="/tag/pptp/">pptp</a>
            
		</span>
    
        
    </div>
    

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'bingdian-ontheway';
        var disqus_title = 'Debian vps下 PPTP VPN 安装笔记';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    
</article><footer id="footer">
    <p class="copyright"><span class="software">Powered by <a href="http://lab.lepture.com/liquidluck/">Felix Felicis</a> 3.8, </span><span class="theme">Theme <a href="http://wlog.cn/" rel="nofollow">responsive</a> 0.1 by <a href="http://wlog.cn/">bingdian</a></span></p>
</footer><!-- #footer -->
</div><!-- #wrapper -->

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-1245097-16']);
_gaq.push(['_trackPageview']);
_gaq.push(['_trackPageLoadTime']);
(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://ssl.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</body>
</html>